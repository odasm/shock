SELECT 
        M.SERV_ID  SERV_ID,
        COUNT(1) REQUEST_TIMES,
        SUM(M.MSG_SIZE)  BUSI_MO_SUM,
        AVG(M.MSG_SIZE)  BUSI_MO_AVG,
        COUNT(DECODE(M.RESPONSE_TIME,NULL,1))  FAILURE_TIMES,
        --TIMESTAMP类型相减是一个字符串下面表达式是计算它们的毫秒差后面一样
        AVG(TO_NUMBER(SUBSTR(M.REQUEST_TIME-M.RECEIVE_TIME+M.SEND_TIME-M.RESPONSE_TIME,2,9))*24*3600000+
TO_NUMBER(SUBSTR(M.REQUEST_TIME-M.RECEIVE_TIME+M.SEND_TIME-M.RESPONSE_TIME,12,2))*3600000+
TO_NUMBER(SUBSTR(M.REQUEST_TIME-M.RECEIVE_TIME+M.SEND_TIME-M.RESPONSE_TIME,15,2))*60000+
TO_NUMBER(SUBSTR(M.REQUEST_TIME-M.RECEIVE_TIME+M.SEND_TIME-M.RESPONSE_TIME,18,2))*1000+
TO_NUMBER(SUBSTR(M.REQUEST_TIME-M.RECEIVE_TIME+M.SEND_TIME-M.RESPONSE_TIME,21,3)))  CSB_ACHIEVE_AVG_TIME,        
        MIN(TO_NUMBER(SUBSTR(M.REQUEST_TIME-M.RECEIVE_TIME+M.SEND_TIME-M.RESPONSE_TIME,2,9))*24*3600000+
TO_NUMBER(SUBSTR(M.REQUEST_TIME-M.RECEIVE_TIME+M.SEND_TIME-M.RESPONSE_TIME,12,2))*3600000+
TO_NUMBER(SUBSTR(M.REQUEST_TIME-M.RECEIVE_TIME+M.SEND_TIME-M.RESPONSE_TIME,15,2))*60000+
TO_NUMBER(SUBSTR(M.REQUEST_TIME-M.RECEIVE_TIME+M.SEND_TIME-M.RESPONSE_TIME,18,2))*1000+
TO_NUMBER(SUBSTR(M.REQUEST_TIME-M.RECEIVE_TIME+M.SEND_TIME-M.RESPONSE_TIME,21,3))) CSB_ACHIEVE_MIN_TIME,
        MAX(TO_NUMBER(SUBSTR(M.REQUEST_TIME-M.RECEIVE_TIME+M.SEND_TIME-M.RESPONSE_TIME,2,9))*24*3600000+
TO_NUMBER(SUBSTR(M.REQUEST_TIME-M.RECEIVE_TIME+M.SEND_TIME-M.RESPONSE_TIME,12,2))*3600000+
TO_NUMBER(SUBSTR(M.REQUEST_TIME-M.RECEIVE_TIME+M.SEND_TIME-M.RESPONSE_TIME,15,2))*60000+
TO_NUMBER(SUBSTR(M.REQUEST_TIME-M.RECEIVE_TIME+M.SEND_TIME-M.RESPONSE_TIME,18,2))*1000+
TO_NUMBER(SUBSTR(M.REQUEST_TIME-M.RECEIVE_TIME+M.SEND_TIME-M.RESPONSE_TIME,21,3)))  CSB_ACHIEVE_MAX_TIME,
        AVG(TO_NUMBER(SUBSTR(M.RESPONSE_TIME-M.REQUEST_TIME,2,9))*24*3600000+
TO_NUMBER(SUBSTR(M.RESPONSE_TIME-M.REQUEST_TIME,12,2))*3600000+
TO_NUMBER(SUBSTR(M.RESPONSE_TIME-M.REQUEST_TIME,15,2))*60000+
TO_NUMBER(SUBSTR(M.RESPONSE_TIME-M.REQUEST_TIME,18,2))*1000+
TO_NUMBER(SUBSTR(M.RESPONSE_TIME-M.REQUEST_TIME,21,3)))  BUSI_SERV_AVG_TIME,        
        MIN(TO_NUMBER(SUBSTR(M.RESPONSE_TIME-M.REQUEST_TIME,2,9))*24*3600000+
TO_NUMBER(SUBSTR(M.RESPONSE_TIME-M.REQUEST_TIME,12,2))*3600000+
TO_NUMBER(SUBSTR(M.RESPONSE_TIME-M.REQUEST_TIME,15,2))*60000+
TO_NUMBER(SUBSTR(M.RESPONSE_TIME-M.REQUEST_TIME,18,2))*1000+
TO_NUMBER(SUBSTR(M.RESPONSE_TIME-M.REQUEST_TIME,21,3))) BUSI_SERV_MIN_TIME,
        MAX(TO_NUMBER(SUBSTR(M.RESPONSE_TIME-M.REQUEST_TIME,2,9))*24*3600000+
TO_NUMBER(SUBSTR(M.RESPONSE_TIME-M.REQUEST_TIME,12,2))*3600000+
TO_NUMBER(SUBSTR(M.RESPONSE_TIME-M.REQUEST_TIME,15,2))*60000+
TO_NUMBER(SUBSTR(M.RESPONSE_TIME-M.REQUEST_TIME,18,2))*1000+
TO_NUMBER(SUBSTR(M.RESPONSE_TIME-M.REQUEST_TIME,21,3)))  BUSI_SERV_MAX_TIME,
                                                                            
        M.SEND_SYSTEM SENDSYSTEM
              
        FROM AIP_MESSAGE M 
        WHERE              
       ( M.RECEIVE_TIME BETWEEN sysdate-1/24 AND sysdate   
        AND  M.SERVICE_STATE!=100)
        OR (M.RECEIVE_TIME BETWEEN sysdate-2/24 AND sysdate-1/24 and
        M.RESPONSE_TIME BETWEEN sysdate-1/24 AND sysdate)
         
        GROUP BY M.SERV_ID,M.SEND_SYSTEM
